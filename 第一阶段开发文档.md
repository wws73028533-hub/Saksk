# ç¼–ç¨‹é¢˜æ¨¡å—ç¬¬ä¸€é˜¶æ®µå¼€å‘æ–‡æ¡£ï¼ˆMVPï¼‰

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-29
- **é˜¶æ®µ**: ç¬¬ä¸€é˜¶æ®µï¼ˆåŸºç¡€åŠŸèƒ½ MVPï¼‰
- **ç›®æ ‡**: å®ç°åŸºæœ¬çš„ç¼–ç¨‹é¢˜åŠŸèƒ½ï¼ŒåŒ…æ‹¬é¢˜ç›®æµè§ˆã€ä»£ç ç¼–è¾‘ã€æ‰§è¡Œå’Œåˆ¤é¢˜

---

## ğŸ¯ å¼€å‘ç›®æ ‡

å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ç¼–ç¨‹é¢˜åœ¨çº¿ç»ƒä¹ å¹³å°ï¼ŒåŒ…æ‹¬ï¼š
- âœ… ç”¨æˆ·ç«¯ï¼šé¢˜ç›®åˆ—è¡¨ã€é¢˜ç›®è¯¦æƒ…ã€ä»£ç ç¼–è¾‘ä¸æ‰§è¡Œã€è‡ªåŠ¨åˆ¤é¢˜
- âœ… ç®¡ç†ç«¯ï¼šé¢˜ç›®ç®¡ç†ï¼ˆCRUDï¼‰ã€æ‰¹é‡æ“ä½œ
- âœ… æ ¸å¿ƒåŠŸèƒ½ï¼šä»£ç æ‰§è¡ŒæœåŠ¡ã€åˆ¤é¢˜æœåŠ¡ã€æäº¤è®°å½•

**çŠ¶æ€ï¼šç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰å¼€å‘å·²å®Œæˆï¼** âœ…

---

## ğŸ“¦ ä»»åŠ¡æ¸…å•

### âœ… å·²å®Œæˆä»»åŠ¡

1. âœ… **åˆ›å»ºæ¨¡å—ç›®å½•ç»“æ„** - å·²å®Œæˆ
2. âœ… **è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„** - å·²å®Œæˆï¼ˆå¤ç”¨ç°æœ‰è¡¨ï¼‰
3. âœ… **å®ç°ä»£ç æ‰§è¡ŒæœåŠ¡**ï¼ˆè¿ç§»å¹¶ä¼˜åŒ–ï¼‰- å·²å®Œæˆ
4. âœ… **å®ç°åˆ¤é¢˜æœåŠ¡** - å·²å®Œæˆ
5. âœ… **å®ç°é¢˜ç›®æœåŠ¡**ï¼ˆCRUDï¼‰- å·²å®Œæˆ
6. âœ… **å®ç°æäº¤æœåŠ¡** - å·²å®Œæˆ
7. âœ… **å®ç°ç”¨æˆ·ç«¯API** - å·²å®Œæˆ
8. âœ… **å®ç°ç”¨æˆ·ç«¯é¡µé¢**ï¼ˆåˆ—è¡¨é¡µã€è¯¦æƒ…é¡µï¼‰- å·²å®Œæˆ
9. âœ… **é›†æˆMonaco Editor** - å·²å®Œæˆ
10. âœ… **å®ç°ç®¡ç†ç«¯API** - å·²å®Œæˆ
11. âœ… **å®ç°ç®¡ç†ç«¯é¡µé¢** - å·²å®Œæˆ

### â¬œ å¾…å®Œæˆä»»åŠ¡

**ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼** ğŸ‰

åç»­å¯è€ƒè™‘çš„åŠŸèƒ½å¢å¼ºï¼š
- æäº¤å†å²é¡µä¼˜åŒ–
- ç»Ÿè®¡é¡µé¢å®Œå–„
- æ”¶è—åŠŸèƒ½å®ç°
- ä»£ç è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–
- æ›´å¤šç¼–ç¨‹è¯­è¨€æ”¯æŒï¼ˆJavaã€C++ï¼‰

---

## ğŸ—ï¸ æ¨¡å—ç»“æ„

### ç›®å½•ç»“æ„

```
app/
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ coding/                      # ç¼–ç¨‹é¢˜æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py              # æ¨¡å—åˆå§‹åŒ–ï¼ˆæ³¨å†Œè“å›¾ï¼‰
â”‚       â”œâ”€â”€ routes/                  # è·¯ç”±å±‚
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ pages.py             # é¡µé¢è·¯ç”±ï¼ˆåˆ—è¡¨é¡µã€è¯¦æƒ…é¡µï¼‰
â”‚       â”‚   â”œâ”€â”€ api.py               # ç”¨æˆ·ç«¯APIè·¯ç”±
â”‚       â”‚   â””â”€â”€ admin.py              # ç®¡ç†ç«¯è·¯ç”±
â”‚       â”œâ”€â”€ services/                # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ question_service.py  # é¢˜ç›®æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ submission_service.py # æäº¤æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ judge_service.py     # åˆ¤é¢˜æœåŠ¡
â”‚       â”‚   â””â”€â”€ code_executor.py     # ä»£ç æ‰§è¡ŒæœåŠ¡
â”‚       â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹å±‚
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ coding_question.py   # ç¼–ç¨‹é¢˜æ¨¡å‹
â”‚       â”‚   â””â”€â”€ code_submission.py   # ä»£ç æäº¤æ¨¡å‹
â”‚       â”œâ”€â”€ schemas/                  # æ•°æ®éªŒè¯å±‚ï¼ˆPydanticï¼‰
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ question_schemas.py  # é¢˜ç›®ç›¸å…³Schema
â”‚       â”‚   â””â”€â”€ submission_schemas.py # æäº¤ç›¸å…³Schema
â”‚       â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ validators.py       # ä»£ç éªŒè¯å™¨
â”‚       â”‚   â””â”€â”€ formatters.py       # è¾“å‡ºæ ¼å¼åŒ–
â”‚       â””â”€â”€ templates/               # æ¨¡æ¿æ–‡ä»¶
â”‚           â”œâ”€â”€ coding/
â”‚           â”‚   â”œâ”€â”€ base.html        # åŸºç¡€æ¨¡æ¿
â”‚           â”‚   â”œâ”€â”€ index.html       # é¢˜ç›®åˆ—è¡¨é¡µ
â”‚           â”‚   â””â”€â”€ detail.html      # é¢˜ç›®è¯¦æƒ…é¡µï¼ˆç¼–è¾‘+æ‰§è¡Œï¼‰
â”‚           â””â”€â”€ admin/
â”‚               â””â”€â”€ coding/
â”‚                   â””â”€â”€ questions.html # é¢˜ç›®ç®¡ç†é¡µ
```

---

## ğŸ“ è¯¦ç»†å¼€å‘ä»»åŠ¡

### ä»»åŠ¡ 3: å®ç°ä»£ç æ‰§è¡ŒæœåŠ¡ï¼ˆè¿ç§»å¹¶ä¼˜åŒ–ï¼‰

**æ–‡ä»¶**: `app/modules/coding/services/code_executor.py`

**åŠŸèƒ½è¦æ±‚**:
- å®‰å…¨æ‰§è¡Œç”¨æˆ·ä»£ç ï¼ˆPythonï¼‰
- æ—¶é—´é™åˆ¶æ§åˆ¶ï¼ˆé»˜è®¤5ç§’ï¼‰
- è¾“å‡ºæˆªæ–­ï¼ˆé˜²æ­¢è¿‡é•¿è¾“å‡ºï¼Œé™åˆ¶10000å­—ç¬¦ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆç¼–è¯‘é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯ã€è¶…æ—¶ï¼‰

**å®ç°è¦ç‚¹**:
```python
from typing import Dict, Any, Optional
import subprocess
import tempfile
import os
from pathlib import Path

class CodeExecutor:
    """ä»£ç æ‰§è¡ŒæœåŠ¡"""
    
    def __init__(self, time_limit: int = 5, output_limit: int = 10000):
        self.time_limit = time_limit
        self.output_limit = output_limit
    
    def execute(
        self, 
        code: str, 
        language: str = 'python',
        input_data: Optional[str] = None
    ) -> Dict[str, Any]:
        """
        æ‰§è¡Œä»£ç 
        
        Args:
            code: ç”¨æˆ·ä»£ç 
            language: ç¼–ç¨‹è¯­è¨€ï¼ˆç›®å‰ä»…æ”¯æŒpythonï¼‰
            input_data: è¾“å…¥æ•°æ®ï¼ˆå¯é€‰ï¼‰
        
        Returns:
            {
                'status': 'success' | 'error' | 'timeout',
                'output': str,
                'error': Optional[str],
                'execution_time': float
            }
        """
        # 1. éªŒè¯ä»£ç ï¼ˆç¦æ­¢å±é™©å‡½æ•°ï¼‰
        # 2. åˆ›å»ºä¸´æ—¶æ–‡ä»¶
        # 3. ä½¿ç”¨subprocessæ‰§è¡Œï¼Œè®¾ç½®è¶…æ—¶
        # 4. æ•è·è¾“å‡ºå’Œé”™è¯¯
        # 5. æˆªæ–­è¾“å‡º
        # 6. è¿”å›ç»“æœ
        pass
```

**å®‰å…¨æªæ–½**:
- ç¦æ­¢ `eval`, `exec`, `__import__`, `open`, `file`, `os.system`, `subprocess` ç­‰å±é™©å‡½æ•°
- ä½¿ç”¨ `subprocess.communicate(timeout=...)` æ§åˆ¶è¶…æ—¶
- é™åˆ¶è¾“å‡ºé•¿åº¦

**è¿ç§»æ¥æº**: `app/services/code_executor.py`

---

### ä»»åŠ¡ 4: å®ç°åˆ¤é¢˜æœåŠ¡

**æ–‡ä»¶**: `app/modules/coding/services/judge_service.py`

**åŠŸèƒ½è¦æ±‚**:
- è§£ææµ‹è¯•ç”¨ä¾‹ï¼ˆJSONæ ¼å¼ï¼‰
- æ‰§è¡Œä»£ç å¹¶éªŒè¯è¾“å‡º
- æ¯”è¾ƒå®é™…è¾“å‡ºä¸æœŸæœ›è¾“å‡º
- ç”Ÿæˆåˆ¤é¢˜ç»“æœ

**å®ç°è¦ç‚¹**:
```python
from typing import Dict, Any, List
from ..services.code_executor import CodeExecutor
import json

class JudgeService:
    """åˆ¤é¢˜æœåŠ¡"""
    
    def __init__(self):
        self.executor = CodeExecutor()
    
    def judge(
        self, 
        question_id: int,
        code: str,
        language: str = 'python'
    ) -> Dict[str, Any]:
        """
        åˆ¤é¢˜
        
        Args:
            question_id: é¢˜ç›®ID
            code: ç”¨æˆ·ä»£ç 
            language: ç¼–ç¨‹è¯­è¨€
        
        Returns:
            {
                'status': 'accepted' | 'wrong_answer' | 'time_limit_exceeded' | 'runtime_error' | 'compilation_error',
                'passed_cases': int,
                'total_cases': int,
                'test_results': List[Dict],
                'execution_time': float,
                'error_message': Optional[str]
            }
        """
        # 1. ä»æ•°æ®åº“è·å–é¢˜ç›®å’Œæµ‹è¯•ç”¨ä¾‹
        # 2. è§£ææµ‹è¯•ç”¨ä¾‹ï¼ˆå…¬å¼€ + éšè—ï¼‰
        # 3. å¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œä»£ç 
        # 4. æ¯”è¾ƒè¾“å‡ºï¼ˆå»é™¤é¦–å°¾ç©ºç™½ï¼‰
        # 5. ç»Ÿè®¡é€šè¿‡ç”¨ä¾‹æ•°
        # 6. ç”Ÿæˆæäº¤è®°å½•
        pass
    
    def _compare_output(self, actual: str, expected: str) -> bool:
        """æ¯”è¾ƒè¾“å‡ºï¼ˆå»é™¤é¦–å°¾ç©ºç™½å’Œæ¢è¡Œç¬¦ï¼‰"""
        actual = actual.strip().rstrip('\n')
        expected = expected.strip().rstrip('\n')
        return actual == expected
```

**æµ‹è¯•ç”¨ä¾‹æ ¼å¼**:
```json
{
  "test_cases": [
    {
      "input": "1\n2",
      "output": "3",
      "description": "ç¤ºä¾‹1"
    }
  ],
  "hidden_cases": [
    {
      "input": "10\n20",
      "output": "30"
    }
  ]
}
```

---

### ä»»åŠ¡ 5: å®ç°é¢˜ç›®æœåŠ¡ï¼ˆCRUDï¼‰

**æ–‡ä»¶**: `app/modules/coding/services/question_service.py`

**åŠŸèƒ½è¦æ±‚**:
- é¢˜ç›®CRUDæ“ä½œ
- é¢˜ç›®æŸ¥è¯¢ä¸ç­›é€‰ï¼ˆæŒ‰ç§‘ç›®ã€éš¾åº¦ã€çŠ¶æ€ï¼‰
- é¢˜ç›®ç»Ÿè®¡ä¿¡æ¯è®¡ç®—ï¼ˆé€šè¿‡ç‡ã€æäº¤æ¬¡æ•°ï¼‰
- æ”¶è—/å–æ¶ˆæ”¶è—

**å®ç°è¦ç‚¹**:
```python
from typing import Dict, Any, List, Optional
from ..utils.database import get_db
from ..schemas.question_schemas import QuestionCreateSchema, QuestionUpdateSchema

class QuestionService:
    """é¢˜ç›®æœåŠ¡"""
    
    @staticmethod
    def get_questions(
        subject_id: Optional[int] = None,
        difficulty: Optional[str] = None,
        status: Optional[str] = None,
        keyword: Optional[str] = None,
        page: int = 1,
        per_page: int = 20,
        user_id: Optional[int] = None
    ) -> Dict[str, Any]:
        """
        è·å–é¢˜ç›®åˆ—è¡¨ï¼ˆå¸¦ç­›é€‰å’Œåˆ†é¡µï¼‰
        
        Returns:
            {
                'questions': List[Dict],
                'total': int,
                'page': int,
                'per_page': int
            }
        """
        # 1. æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼ˆWHEREå­å¥ï¼‰
        # 2. æ‰§è¡Œåˆ†é¡µæŸ¥è¯¢
        # 3. è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ï¼ˆé€šè¿‡ç‡ã€æäº¤æ¬¡æ•°ï¼‰
        # 4. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆæ˜¯å¦å®Œæˆã€æ˜¯å¦æ”¶è—ï¼‰
        pass
    
    @staticmethod
    def get_question(question_id: int, user_id: Optional[int] = None) -> Optional[Dict[str, Any]]:
        """è·å–é¢˜ç›®è¯¦æƒ…"""
        pass
    
    @staticmethod
    def create_question(data: QuestionCreateSchema) -> Dict[str, Any]:
        """åˆ›å»ºé¢˜ç›®"""
        pass
    
    @staticmethod
    def update_question(question_id: int, data: QuestionUpdateSchema) -> Dict[str, Any]:
        """æ›´æ–°é¢˜ç›®"""
        pass
    
    @staticmethod
    def delete_question(question_id: int) -> bool:
        """åˆ é™¤é¢˜ç›®"""
        pass
    
    @staticmethod
    def calculate_statistics(question_id: int) -> Dict[str, Any]:
        """è®¡ç®—é¢˜ç›®ç»Ÿè®¡ä¿¡æ¯ï¼ˆé€šè¿‡ç‡ã€æäº¤æ¬¡æ•°ï¼‰"""
        pass
```

**æ•°æ®åº“æŸ¥è¯¢**:
- ä½¿ç”¨ `q_type='ç¼–ç¨‹é¢˜'` ç­›é€‰ç¼–ç¨‹é¢˜
- é€šè¿‡ `code_submissions` è¡¨è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
- ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥

---

### ä»»åŠ¡ 6: å®ç°æäº¤æœåŠ¡

**æ–‡ä»¶**: `app/modules/coding/services/submission_service.py`

**åŠŸèƒ½è¦æ±‚**:
- æäº¤è®°å½•CRUD
- æäº¤å†å²æŸ¥è¯¢ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
- æäº¤ç»Ÿè®¡è®¡ç®—
- æœ€ä½³æäº¤è®°å½•æŸ¥è¯¢

**å®ç°è¦ç‚¹**:
```python
from typing import Dict, Any, List, Optional
from ..utils.database import get_db
from ..schemas.submission_schemas import SubmissionCreateSchema

class SubmissionService:
    """æäº¤æœåŠ¡"""
    
    @staticmethod
    def create_submission(
        user_id: int,
        question_id: int,
        code: str,
        language: str,
        judge_result: Dict[str, Any]
    ) -> Dict[str, Any]:
        """
        åˆ›å»ºæäº¤è®°å½•
        
        Args:
            judge_result: åˆ¤é¢˜ç»“æœï¼ˆæ¥è‡ªJudgeServiceï¼‰
        """
        pass
    
    @staticmethod
    def get_submissions(
        user_id: Optional[int] = None,
        question_id: Optional[int] = None,
        status: Optional[str] = None,
        page: int = 1,
        per_page: int = 20
    ) -> Dict[str, Any]:
        """è·å–æäº¤å†å²ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰"""
        pass
    
    @staticmethod
    def get_submission(submission_id: int, user_id: Optional[int] = None) -> Optional[Dict[str, Any]]:
        """è·å–æäº¤è¯¦æƒ…"""
        pass
    
    @staticmethod
    def get_best_submission(user_id: int, question_id: int) -> Optional[Dict[str, Any]]:
        """è·å–æœ€ä½³æäº¤è®°å½•ï¼ˆé¦–æ¬¡é€šè¿‡ï¼‰"""
        pass
    
    @staticmethod
    def get_user_statistics(user_id: int) -> Dict[str, Any]:
        """è·å–ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯"""
        pass
```

**æ•°æ®åº“å­—æ®µ**ï¼ˆ`code_submissions` è¡¨ï¼‰:
- `id`, `user_id`, `question_id`, `code`, `language`
- `status` (accepted/wrong_answer/time_limit_exceeded/runtime_error/compilation_error)
- `passed_cases`, `total_cases`, `execution_time`, `error_message`, `submitted_at`

---

### ä»»åŠ¡ 7: å®ç°ç”¨æˆ·ç«¯API

**æ–‡ä»¶**: `app/modules/coding/routes/api.py`

**APIç«¯ç‚¹**:

#### 7.1 é¢˜ç›®ç›¸å…³API

```python
# GET /coding/api/questions
# è·å–é¢˜ç›®åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ã€åˆ†é¡µï¼‰
@coding_api_bp.route('/questions', methods=['GET'])
@login_required
def api_get_questions():
    """è·å–é¢˜ç›®åˆ—è¡¨"""
    try:
        subject_id = request.args.get('subject', type=int)
        difficulty = request.args.get('difficulty')
        status = request.args.get('status')
        keyword = request.args.get('keyword', '').strip()
        page = request.args.get('page', 1, type=int)
        per_page = request.args.get('per_page', 20, type=int)
        
        user_id = session.get('user_id')
        result = QuestionService.get_questions(
            subject_id=subject_id,
            difficulty=difficulty,
            status=status,
            keyword=keyword,
            page=page,
            per_page=per_page,
            user_id=user_id
        )
        
        return jsonify({
            'status': 'success',
            'data': result
        })
    except Exception as e:
        current_app.logger.error(f"è·å–é¢˜ç›®åˆ—è¡¨å¤±è´¥: {e}", exc_info=True)
        return jsonify({
            'status': 'error',
            'message': 'è·å–é¢˜ç›®åˆ—è¡¨å¤±è´¥'
        }), 500

# GET /coding/api/questions/<question_id>
# è·å–é¢˜ç›®è¯¦æƒ…
@coding_api_bp.route('/questions/<int:question_id>', methods=['GET'])
@login_required
def api_get_question(question_id: int):
    """è·å–é¢˜ç›®è¯¦æƒ…"""
    pass
```

#### 7.2 ä»£ç æ‰§è¡ŒAPI

```python
# POST /coding/api/execute
# è¿è¡Œä»£ç ï¼ˆä¸åˆ¤é¢˜ï¼‰
@coding_api_bp.route('/execute', methods=['POST'])
@login_required
@limiter.limit("10 per minute")
def api_execute():
    """è¿è¡Œä»£ç """
    try:
        data = request.get_json()
        if not data:
            return jsonify({
                'status': 'error',
                'message': 'è¯·æ±‚æ•°æ®ä¸èƒ½ä¸ºç©º'
            }), 400
        
        # ä½¿ç”¨PydanticéªŒè¯
        schema = ExecuteCodeSchema.parse_obj(data)
        
        executor = CodeExecutor()
        result = executor.execute(
            code=schema.code,
            language=schema.language,
            input_data=schema.input
        )
        
        return jsonify({
            'status': 'success',
            'data': result
        })
    except ValueError as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 400
    except Exception as e:
        current_app.logger.error(f"ä»£ç æ‰§è¡Œå¤±è´¥: {e}", exc_info=True)
        return jsonify({
            'status': 'error',
            'message': 'ä»£ç æ‰§è¡Œå¤±è´¥'
        }), 500

# POST /coding/api/submit
# æäº¤ä»£ç ï¼ˆè‡ªåŠ¨åˆ¤é¢˜ï¼‰
@coding_api_bp.route('/submit', methods=['POST'])
@login_required
@limiter.limit("5 per minute")
def api_submit():
    """æäº¤ä»£ç """
    try:
        data = request.get_json()
        schema = SubmitCodeSchema.parse_obj(data)
        
        user_id = session.get('user_id')
        
        # åˆ¤é¢˜
        judge_service = JudgeService()
        judge_result = judge_service.judge(
            question_id=schema.question_id,
            code=schema.code,
            language=schema.language
        )
        
        # åˆ›å»ºæäº¤è®°å½•
        submission = SubmissionService.create_submission(
            user_id=user_id,
            question_id=schema.question_id,
            code=schema.code,
            language=schema.language,
            judge_result=judge_result
        )
        
        return jsonify({
            'status': 'success',
            'data': {
                'submission_id': submission['id'],
                **judge_result
            }
        })
    except ValueError as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 400
    except Exception as e:
        current_app.logger.error(f"æäº¤ä»£ç å¤±è´¥: {e}", exc_info=True)
        return jsonify({
            'status': 'error',
            'message': 'æäº¤ä»£ç å¤±è´¥'
        }), 500
```

#### 7.3 æäº¤å†å²API

```python
# GET /coding/api/submissions
# è·å–æäº¤å†å²
@coding_api_bp.route('/submissions', methods=['GET'])
@login_required
def api_get_submissions():
    """è·å–æäº¤å†å²"""
    pass

# GET /coding/api/submissions/<submission_id>
# è·å–æäº¤è¯¦æƒ…
@coding_api_bp.route('/submissions/<int:submission_id>', methods=['GET'])
@login_required
def api_get_submission(submission_id: int):
    """è·å–æäº¤è¯¦æƒ…"""
    pass
```

**å“åº”æ ¼å¼è§„èŒƒ**:
```python
# æˆåŠŸå“åº”
{
    "status": "success",
    "data": {...}
}

# é”™è¯¯å“åº”
{
    "status": "error",
    "message": "é”™è¯¯æè¿°"
}
```

---

### ä»»åŠ¡ 8: å®ç°ç”¨æˆ·ç«¯é¡µé¢

#### 8.1 é¢˜ç›®åˆ—è¡¨é¡µ

**æ–‡ä»¶**: `app/modules/coding/templates/coding/index.html`

**åŠŸèƒ½**:
- æ˜¾ç¤ºé¢˜ç›®åˆ—è¡¨ï¼ˆå¡ç‰‡å¼å¸ƒå±€ï¼‰
- ç­›é€‰å™¨ï¼ˆç§‘ç›®ã€éš¾åº¦ã€çŠ¶æ€ï¼‰
- æœç´¢æ¡†
- åˆ†é¡µå™¨

**UIè®¾è®¡**:
- iOS 18é£æ ¼ï¼Œæ¯›ç»ç’ƒæ•ˆæœå¡ç‰‡
- å“åº”å¼å¸ƒå±€
- é¢˜ç›®å¡ç‰‡æ˜¾ç¤ºï¼šæ ‡é¢˜ã€éš¾åº¦ã€é€šè¿‡ç‡ã€æäº¤æ¬¡æ•°ã€çŠ¶æ€

**JavaScriptå®ç°**:
```javascript
// åŠ è½½é¢˜ç›®åˆ—è¡¨
async function loadQuestions() {
    try {
        const params = new URLSearchParams({
            page: currentPage,
            per_page: 20,
            ...filters
        });
        const res = await fetch(`/coding/api/questions?${params}`);
        const result = await res.json();
        if (result.status === 'success') {
            renderQuestions(result.data.questions);
            updatePagination(result.data);
        }
    } catch (error) {
        console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', error);
    }
}
```

#### 8.2 é¢˜ç›®è¯¦æƒ…é¡µ

**æ–‡ä»¶**: `app/modules/coding/templates/coding/detail.html`

**å¸ƒå±€**:
- å·¦ä¾§ï¼šé¢˜ç›®æè¿°åŒºåŸŸ
  - é¢˜ç›®æ ‡é¢˜
  - é¢˜ç›®æè¿°ï¼ˆMarkdownæ¸²æŸ“ï¼‰
  - è¾“å…¥è¾“å‡ºç¤ºä¾‹
  - çº¦æŸæ¡ä»¶
- å³ä¾§ï¼šä»£ç ç¼–è¾‘åŒºåŸŸ
  - Monaco Editorï¼ˆä»£ç ç¼–è¾‘å™¨ï¼‰
  - å·¥å…·æ ï¼ˆè¿è¡Œã€æäº¤ã€é‡ç½®ï¼‰
  - è¾“å‡ºé¢æ¿ï¼ˆæ‰§è¡Œç»“æœã€æµ‹è¯•ç”¨ä¾‹ç»“æœï¼‰

**åŠŸèƒ½**:
- ä»£ç è‡ªåŠ¨ä¿å­˜ï¼ˆLocalStorageï¼‰
- ä»£ç æ¨¡æ¿åŠ è½½
- è¿è¡Œä»£ç ï¼ˆä¸åˆ¤é¢˜ï¼‰
- æäº¤ä»£ç ï¼ˆè‡ªåŠ¨åˆ¤é¢˜ï¼‰
- æŸ¥çœ‹å†å²æäº¤è®°å½•

---

### ä»»åŠ¡ 9: é›†æˆMonaco Editor

**æ–‡ä»¶**: `app/modules/coding/templates/coding/detail.html`

**é›†æˆæ–¹å¼**:
```html
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs/loader.js"></script>
<script>
require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@latest/min/vs' } });
require(['vs/editor/editor.main'], function () {
    const editor = monaco.editor.create(document.getElementById('editor'), {
        value: codeTemplate,
        language: 'python',
        theme: 'vs-dark',
        fontSize: 14,
        minimap: { enabled: false },
        scrollBeyondLastLine: false,
        automaticLayout: true
    });
    
    // ä»£ç è‡ªåŠ¨ä¿å­˜
    editor.onDidChangeModelContent(() => {
        const code = editor.getValue();
        localStorage.setItem(`coding_${questionId}`, code);
    });
    
    // åŠ è½½ä¿å­˜çš„ä»£ç 
    const savedCode = localStorage.getItem(`coding_${questionId}`);
    if (savedCode) {
        editor.setValue(savedCode);
    }
});
</script>
```

**åŠŸèƒ½**:
- è¯­æ³•é«˜äº®
- ä»£ç è¡¥å…¨
- ä»£ç æ ¼å¼åŒ–
- ä¸»é¢˜åˆ‡æ¢ï¼ˆæµ…è‰²/æ·±è‰²ï¼‰
- ä»£ç è‡ªåŠ¨ä¿å­˜

---

### ä»»åŠ¡ 10: å®ç°ç®¡ç†ç«¯API

**æ–‡ä»¶**: `app/modules/coding/routes/admin.py`

**APIç«¯ç‚¹**:

```python
# GET /admin/coding/api/questions
# è·å–é¢˜ç›®åˆ—è¡¨ï¼ˆç®¡ç†ç«¯ï¼‰
@coding_admin_bp.route('/api/questions', methods=['GET'])
@admin_required
def api_get_questions():
    """è·å–é¢˜ç›®åˆ—è¡¨ï¼ˆç®¡ç†ç«¯ï¼‰"""
    pass

# POST /admin/coding/api/questions
# åˆ›å»ºé¢˜ç›®
@coding_admin_bp.route('/api/questions', methods=['POST'])
@admin_required
def api_create_question():
    """åˆ›å»ºé¢˜ç›®"""
    try:
        data = request.get_json()
        schema = QuestionCreateSchema.parse_obj(data)
        
        question = QuestionService.create_question(schema)
        
        return jsonify({
            'status': 'success',
            'message': 'é¢˜ç›®åˆ›å»ºæˆåŠŸ',
            'data': question
        }), 201
    except ValueError as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 400

# PUT /admin/coding/api/questions/<question_id>
# æ›´æ–°é¢˜ç›®
@coding_admin_bp.route('/api/questions/<int:question_id>', methods=['PUT'])
@admin_required
def api_update_question(question_id: int):
    """æ›´æ–°é¢˜ç›®"""
    pass

# DELETE /admin/coding/api/questions/<question_id>
# åˆ é™¤é¢˜ç›®
@coding_admin_bp.route('/api/questions/<question_id>', methods=['DELETE'])
@admin_required
def api_delete_question(question_id: int):
    """åˆ é™¤é¢˜ç›®"""
    pass

# POST /admin/coding/api/questions/batch_delete
# æ‰¹é‡åˆ é™¤
@coding_admin_bp.route('/api/questions/batch_delete', methods=['POST'])
@admin_required
def api_batch_delete_questions():
    """æ‰¹é‡åˆ é™¤é¢˜ç›®"""
    pass
```

**æƒé™æ§åˆ¶**:
- ä½¿ç”¨ `@admin_required` è£…é¥°å™¨
- æˆ–ä½¿ç”¨ `@subject_admin_required`ï¼ˆå¦‚æœå…è®¸ç§‘ç›®ç®¡ç†å‘˜ç®¡ç†ç¼–ç¨‹é¢˜ï¼‰

---

### ä»»åŠ¡ 11: å®ç°ç®¡ç†ç«¯é¡µé¢

**æ–‡ä»¶**: `app/modules/coding/templates/admin/coding/questions.html`

**åŠŸèƒ½**:
- é¢˜ç›®åˆ—è¡¨ï¼ˆè¡¨æ ¼å±•ç¤ºï¼‰
- åˆ›å»ºé¢˜ç›®æŒ‰é’®
- ç¼–è¾‘/åˆ é™¤æ“ä½œ
- æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡åˆ é™¤ï¼‰
- é¢˜ç›®çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

**UIè®¾è®¡**:
- éµå¾ªç®¡ç†åå°UIè§„èŒƒ
- ä½¿ç”¨ç»Ÿä¸€çš„è¡¨æ ¼æ ·å¼
- æ“ä½œä¸‹æ‹‰èœå•ï¼ˆå³ä¾§å¼¹å‡ºï¼‰

**JavaScriptå®ç°**:
```javascript
// åŠ è½½é¢˜ç›®åˆ—è¡¨
async function loadQuestions() {
    try {
        const res = await fetch('/admin/coding/api/questions');
        const result = await res.json();
        if (result.status === 'success') {
            renderQuestions(result.data.questions);
        }
    } catch (error) {
        console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', error);
    }
}

// åˆ›å»ºé¢˜ç›®
async function createQuestion(data) {
    try {
        const res = await fetch('/admin/coding/api/questions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        const result = await res.json();
        if (result.status === 'success') {
            showSuccess('é¢˜ç›®åˆ›å»ºæˆåŠŸ');
            loadQuestions();
        } else {
            showError(result.message);
        }
    } catch (error) {
        showError('åˆ›å»ºé¢˜ç›®å¤±è´¥');
    }
}
```

---

## ğŸ”§ å¼€å‘è§„èŒƒ

### ä»£ç ç»„ç»‡

1. **æ¨¡å—ç‹¬ç«‹æ€§**: ç¼–ç¨‹é¢˜æ¨¡å—å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¸å…¶ä»–æ¨¡å—æ··åˆ
2. **åˆ†å±‚æ¶æ„**: è·¯ç”±å±‚ â†’ æœåŠ¡å±‚ â†’ æ•°æ®æ¨¡å‹å±‚
3. **ç±»å‹æç¤º**: æ‰€æœ‰å‡½æ•°å¿…é¡»ä½¿ç”¨ç±»å‹æç¤º
4. **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

### APIè®¾è®¡

1. **RESTfulé£æ ¼**: ä½¿ç”¨æ ‡å‡†HTTPæ–¹æ³•å’ŒçŠ¶æ€ç 
2. **å“åº”æ ¼å¼**: ç»Ÿä¸€çš„JSONæ ¼å¼ï¼ˆ`status`, `message`, `data`ï¼‰
3. **æ•°æ®éªŒè¯**: ä½¿ç”¨Pydanticè¿›è¡Œè¾“å…¥éªŒè¯
4. **æƒé™æ§åˆ¶**: ä½¿ç”¨è£…é¥°å™¨ä¿æŠ¤API

### æ•°æ®åº“æ“ä½œ

1. **å‚æ•°åŒ–æŸ¥è¯¢**: ä½¿ç”¨ `?` å ä½ç¬¦ï¼Œé˜²æ­¢SQLæ³¨å…¥
2. **äº‹åŠ¡å¤„ç†**: ä½¿ç”¨ `commit()` å’Œ `rollback()`
3. **å­—æ®µæ£€æŸ¥**: ä½¿ç”¨ `PRAGMA table_info()` æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨

### UIè®¾è®¡

1. **iOS 18é£æ ¼**: æ¯›ç»ç’ƒæ•ˆæœã€åœ†è§’ã€æŸ”å’Œé˜´å½±
2. **å“åº”å¼å¸ƒå±€**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸
3. **ç»Ÿä¸€ç»„ä»¶**: ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„æŒ‰é’®ã€å¡ç‰‡ã€è¡¨æ ¼æ ·å¼

---

## ğŸ“‹ å¼€å‘é¡ºåºå»ºè®®

### ç¬¬ä¸€é˜¶æ®µå¼€å‘é¡ºåº

1. **åŸºç¡€æœåŠ¡å±‚**ï¼ˆä»»åŠ¡3-6ï¼‰
   - å…ˆå®ç°ä»£ç æ‰§è¡ŒæœåŠ¡ï¼ˆä»»åŠ¡3ï¼‰
   - å†å®ç°åˆ¤é¢˜æœåŠ¡ï¼ˆä»»åŠ¡4ï¼Œä¾èµ–ä»»åŠ¡3ï¼‰
   - ç„¶åå®ç°é¢˜ç›®æœåŠ¡ï¼ˆä»»åŠ¡5ï¼‰
   - æœ€åå®ç°æäº¤æœåŠ¡ï¼ˆä»»åŠ¡6ï¼‰

2. **ç”¨æˆ·ç«¯åŠŸèƒ½**ï¼ˆä»»åŠ¡7-9ï¼‰
   - å®ç°ç”¨æˆ·ç«¯APIï¼ˆä»»åŠ¡7ï¼‰
   - å®ç°ç”¨æˆ·ç«¯é¡µé¢ï¼ˆä»»åŠ¡8ï¼‰
   - é›†æˆMonaco Editorï¼ˆä»»åŠ¡9ï¼‰

3. **ç®¡ç†ç«¯åŠŸèƒ½**ï¼ˆä»»åŠ¡10-11ï¼‰
   - å®ç°ç®¡ç†ç«¯APIï¼ˆä»»åŠ¡10ï¼‰
   - å®ç°ç®¡ç†ç«¯é¡µé¢ï¼ˆä»»åŠ¡11ï¼‰

---

## âœ… æ£€æŸ¥æ¸…å•

æ¯ä¸ªä»»åŠ¡å®Œæˆåï¼Œæ£€æŸ¥ï¼š

- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒï¼ˆç±»å‹æç¤ºã€é”™è¯¯å¤„ç†ã€å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- [ ] APIè¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼
- [ ] UIéµå¾ªiOS 18è®¾è®¡é£æ ¼
- [ ] æ·»åŠ å¿…è¦çš„æƒé™æ£€æŸ¥
- [ ] ä»£ç æœ‰é€‚å½“çš„æ³¨é‡Š
- [ ] éµå¾ªRESTful APIè®¾è®¡åŸåˆ™
- [ ] å‰ç«¯ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥æ“ä½œ
- [ ] æ•°æ®åº“æ“ä½œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- [ ] é”™è¯¯å¤„ç†å®Œå–„ï¼ˆtry-exceptã€æ—¥å¿—è®°å½•ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æº

- **Monaco Editor**: https://microsoft.github.io/monaco-editor/
- **Flask-RESTful**: https://flask-restful.readthedocs.io/
- **Pydantic**: https://docs.pydantic.dev/
- **iOSè®¾è®¡æŒ‡å—**: https://developer.apple.com/design/human-interface-guidelines/
- **é¡¹ç›®è§„èŒƒ**: `.cursor/rules/admin-guide.mdc`, `.cursor/rules/flask-restful.mdc`

---

## ğŸš€ å¼€å‘å®Œæˆ

**ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼** âœ…

### å®Œæˆæƒ…å†µæ€»ç»“

æ‰€æœ‰11ä¸ªä»»åŠ¡å‡å·²å®Œæˆï¼š
- âœ… æ¨¡å—ç›®å½•ç»“æ„å·²åˆ›å»º
- âœ… æ•°æ®åº“è¡¨ç»“æ„å·²è®¾è®¡ï¼ˆå¤ç”¨ç°æœ‰è¡¨ï¼‰
- âœ… ä»£ç æ‰§è¡ŒæœåŠ¡å·²å®ç°ï¼ˆæ”¯æŒPythonï¼Œå¸¦å®‰å…¨éªŒè¯ï¼‰
- âœ… åˆ¤é¢˜æœåŠ¡å·²å®ç°ï¼ˆæ”¯æŒæµ‹è¯•ç”¨ä¾‹éªŒè¯ï¼‰
- âœ… é¢˜ç›®æœåŠ¡å·²å®ç°ï¼ˆCRUDã€ç­›é€‰ã€ç»Ÿè®¡ï¼‰
- âœ… æäº¤æœåŠ¡å·²å®ç°ï¼ˆæäº¤è®°å½•ã€å†å²æŸ¥è¯¢ã€ç»Ÿè®¡ï¼‰
- âœ… ç”¨æˆ·ç«¯APIå·²å®ç°ï¼ˆé¢˜ç›®ã€æ‰§è¡Œã€æäº¤ã€å†å²ã€ç»Ÿè®¡ï¼‰
- âœ… ç”¨æˆ·ç«¯é¡µé¢å·²å®ç°ï¼ˆåˆ—è¡¨é¡µã€è¯¦æƒ…é¡µï¼ŒiOS 18é£æ ¼ï¼‰
- âœ… Monaco Editorå·²é›†æˆï¼ˆä»£ç ç¼–è¾‘ã€è‡ªåŠ¨ä¿å­˜ï¼‰
- âœ… ç®¡ç†ç«¯APIå·²å®ç°ï¼ˆé¢˜ç›®CRUDã€æ‰¹é‡æ“ä½œï¼‰
- âœ… ç®¡ç†ç«¯é¡µé¢å·²å®ç°ï¼ˆé¢˜ç›®ç®¡ç†ç•Œé¢ï¼‰

### åŠŸèƒ½ç‰¹æ€§

- **ä»£ç æ‰§è¡Œ**ï¼šå®‰å…¨çš„Pythonä»£ç æ‰§è¡Œï¼Œå¸¦è¶…æ—¶æ§åˆ¶å’Œè¾“å‡ºé™åˆ¶
- **è‡ªåŠ¨åˆ¤é¢˜**ï¼šæ”¯æŒå…¬å¼€å’Œéšè—æµ‹è¯•ç”¨ä¾‹ï¼Œè‡ªåŠ¨éªŒè¯ä»£ç æ­£ç¡®æ€§
- **ç”¨æˆ·ç•Œé¢**ï¼šiOS 18é£æ ¼è®¾è®¡ï¼Œæ¯›ç»ç’ƒæ•ˆæœï¼Œå“åº”å¼å¸ƒå±€
- **ä»£ç ç¼–è¾‘**ï¼šMonaco Editoré›†æˆï¼Œæ”¯æŒè¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨
- **æäº¤ç®¡ç†**ï¼šå®Œæ•´çš„æäº¤å†å²ã€ç»Ÿè®¡ä¿¡æ¯
- **é¢˜ç›®ç®¡ç†**ï¼šç®¡ç†å‘˜å¯åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®ï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ

### åç»­ä¼˜åŒ–å»ºè®®

1. **åŠŸèƒ½å¢å¼º**ï¼š
   - æäº¤å†å²é¡µä¼˜åŒ–ï¼ˆç‹¬ç«‹é¡µé¢ï¼‰
   - ç»Ÿè®¡é¡µé¢å®Œå–„ï¼ˆå¯è§†åŒ–å›¾è¡¨ï¼‰
   - æ”¶è—åŠŸèƒ½å®ç°
   - ä»£ç è‡ªåŠ¨ä¿å­˜ä¼˜åŒ–ï¼ˆå®æ—¶ä¿å­˜ï¼‰

2. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - ä»£ç æ‰§è¡Œæ€§èƒ½ä¼˜åŒ–
   - åˆ¤é¢˜æœåŠ¡å¹¶å‘å¤„ç†
   - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

3. **åŠŸèƒ½æ‰©å±•**ï¼š
   - æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€ï¼ˆJavaã€C++ï¼‰
   - ä»£ç å¯¹æ¯”åŠŸèƒ½ï¼ˆä¸å†å²æäº¤å¯¹æ¯”ï¼‰
   - è®¨è®ºåŒºåŠŸèƒ½ï¼ˆé¢˜ç›®è¯„è®ºï¼‰
   - æ’è¡Œæ¦œåŠŸèƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2025-12-29  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**çŠ¶æ€**: ç¬¬ä¸€é˜¶æ®µï¼ˆMVPï¼‰å¼€å‘å·²å®Œæˆ âœ…

