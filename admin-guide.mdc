---
alwaysApply: true
description: Adminæ¨¡å—å¼€å‘ä¸ç»´æŠ¤æŒ‡å— - ç”¨äºç»´æŠ¤å’Œæ–°å¢ç®¡ç†åå°åŠŸèƒ½
globs: app/routes/admin.py, app/templates/admin*.html
---

# Adminæ¨¡å—å¼€å‘ä¸ç»´æŠ¤æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ç®¡ç†åå°æ¨¡å—çš„å®Œæ•´å¼€å‘ä¸ç»´æŠ¤æŒ‡å—ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£æ¶æ„ã€æ·»åŠ æ–°åŠŸèƒ½å’Œç»´æŠ¤ç°æœ‰ä»£ç ã€‚

## 1. é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### 1.1 ç›®å½•ç»“æ„

```
app/
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ admin.py              # ç®¡ç†åå°è·¯ç”±è“å›¾ï¼ˆæ‰€æœ‰APIå’Œé¡µé¢è·¯ç”±ï¼‰
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ admin_base.html       # ç®¡ç†åå°åŸºç¡€æ¨¡æ¿ï¼ˆä¾§è¾¹æ ã€å¯¼èˆªï¼‰
â”‚   â”œâ”€â”€ admin_dashboard.html  # ä»ªè¡¨ç›˜é¡µé¢
â”‚   â”œâ”€â”€ admin_subjects.html   # ç§‘ç›®ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ admin_questions.html  # é¢˜ç›®ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ admin_users.html      # ç”¨æˆ·ç®¡ç†é¡µé¢
â”‚   â””â”€â”€ admin_*.html          # å…¶ä»–ç®¡ç†é¡µé¢
â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ question.py
â”‚   â””â”€â”€ exam.py
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ validators.py        # æ•°æ®éªŒè¯
â”‚   â””â”€â”€ decorators.py        # è£…é¥°å™¨ï¼ˆæƒé™æ§åˆ¶ï¼‰
â””â”€â”€ extensions.py            # Flaskæ‰©å±•åˆå§‹åŒ–
```

### 1.2 æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Flask + Flask-RESTful
- **æ•°æ®åº“**: SQLiteï¼ˆé€šè¿‡ `utils.database.get_db()` è®¿é—®ï¼‰
- **å‰ç«¯**: åŸç”ŸHTML/CSS/JavaScriptï¼ˆiOS 18é£æ ¼UIï¼‰
- **æƒé™æ§åˆ¶**: Session-based + `@admin_required` è£…é¥°å™¨
- **æ•°æ®éªŒè¯**: Pydanticï¼ˆæ¨èï¼‰æˆ–è‡ªå®šä¹‰éªŒè¯å™¨

## 2. ä»£ç ç»„ç»‡è§„èŒƒ

### 2.1 è·¯ç”±ç»„ç»‡åŸåˆ™

**âœ… GOOD: æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡è·¯ç”±**

```python
# app/routes/admin.py

admin_bp = Blueprint('admin', __name__, url_prefix='/admin')

# ========== ä»ªè¡¨ç›˜ç›¸å…³ ==========
@admin_bp.route('/')
@admin_bp.route('/dashboard')
def admin_dashboard():
    """ç®¡ç†åå°é¦–é¡µ"""
    # ...

# ========== ç§‘ç›®ç®¡ç† ==========
@admin_bp.route('/subjects')
def admin_subjects_page():
    """ç§‘ç›®ç®¡ç†é¡µé¢"""
    # ...

@admin_bp.route('/api/subjects', methods=['GET'])
def api_get_subjects():
    """è·å–ç§‘ç›®åˆ—è¡¨API"""
    # ...

# ========== é¢˜ç›®ç®¡ç† ==========
@admin_bp.route('/subjects/<int:subject_id>/questions')
def admin_questions_page(subject_id):
    """é¢˜é›†ç®¡ç†é¡µé¢"""
    # ...
```

**âŒ BAD: ä¸è¦å°†æ‰€æœ‰è·¯ç”±æ··åœ¨ä¸€èµ·**

```python
# ä¸è¦è¿™æ ·åš - è·¯ç”±æ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤
@admin_bp.route('/subjects')
def subjects(): pass

@admin_bp.route('/questions')
def questions(): pass

@admin_bp.route('/subjects')  # é‡å¤å®šä¹‰
def subjects2(): pass
```

### 2.2 APIè·¯ç”±å‘½åè§„èŒƒ

- **é¡µé¢è·¯ç”±**: æ— å‰ç¼€ï¼Œç›´æ¥è·¯å¾„ï¼Œå¦‚ `/admin/subjects`
- **APIè·¯ç”±**: ä½¿ç”¨ `/admin/api/` å‰ç¼€ï¼Œå¦‚ `/admin/api/subjects`
- **RESTfulé£æ ¼**: 
  - `GET /admin/api/subjects` - è·å–åˆ—è¡¨
  - `POST /admin/api/subjects` - åˆ›å»º
  - `PUT /admin/api/subjects/<id>` - æ›´æ–°
  - `DELETE /admin/api/subjects/<id>` - åˆ é™¤

### 2.3 å“åº”æ ¼å¼è§„èŒƒ

**æ‰€æœ‰APIå¿…é¡»è¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼ï¼š**

```python
# æˆåŠŸå“åº”
{
    "status": "success",
    "message": "æ“ä½œæˆåŠŸ",
    "data": {...}  # å¯é€‰
}

# é”™è¯¯å“åº”
{
    "status": "error",
    "message": "é”™è¯¯æè¿°"
}

# æˆ–ä½¿ç”¨HTTPçŠ¶æ€ç 
return jsonify({'status': 'error', 'message': '...'}), 400
```

## 3. æ·»åŠ æ–°åŠŸèƒ½

### 3.1 æ·»åŠ æ–°ç®¡ç†é¡µé¢ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

**æ­¥éª¤1: åœ¨ `admin.py` ä¸­æ·»åŠ è·¯ç”±**

```python
# ========== æ–°åŠŸèƒ½æ¨¡å—ï¼šç»Ÿè®¡æŠ¥è¡¨ ==========
@admin_bp.route('/reports')
def admin_reports_page():
    """ç»Ÿè®¡æŠ¥è¡¨é¡µé¢"""
    return render_template('admin_reports.html')

@admin_bp.route('/api/reports/summary', methods=['GET'])
def api_get_reports_summary():
    """è·å–æŠ¥è¡¨æ±‡æ€»æ•°æ®"""
    try:
        conn = get_db()
        # æŸ¥è¯¢æ•°æ®
        data = conn.execute('''
            SELECT 
                COUNT(*) as total,
                SUM(CASE WHEN status = 'active' THEN 1 ELSE 0 END) as active
            FROM your_table
        ''').fetchone()
        
        return jsonify({
            'status': 'success',
            'data': dict(data)
        })
    except Exception as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 500
```

**æ­¥éª¤2: åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ `admin_reports.html`**

```html
{% extends "admin_base.html" %}

{% block title %}ç»Ÿè®¡æŠ¥è¡¨{% endblock %}

{% block head %}
<style>
    /* iOS 18é£æ ¼æ ·å¼ */
    .container {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(30px) saturate(180%);
        -webkit-backdrop-filter: blur(30px) saturate(180%);
        padding: 40px;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-soft);
        border: 0.5px solid var(--border-color);
    }
    
    /* ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„CSSå˜é‡ */
    .stat-card {
        background: var(--card-bg);
        border: 0.5px solid var(--border-color);
        border-radius: var(--radius-md);
        padding: 24px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1>ç»Ÿè®¡æŠ¥è¡¨</h1>
    <div id="reportsContent">
        <!-- å†…å®¹ -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // åŠ è½½æ•°æ®
    async function loadReports() {
        try {
            const res = await fetch('/admin/api/reports/summary');
            const result = await res.json();
            if (result.status === 'success') {
                // æ¸²æŸ“æ•°æ®
                renderReports(result.data);
            }
        } catch (error) {
            console.error('åŠ è½½æŠ¥è¡¨å¤±è´¥:', error);
        }
    }
    
    document.addEventListener('DOMContentLoaded', loadReports);
</script>
{% endblock %}
```

**æ­¥éª¤3: åœ¨ `admin_base.html` ä¾§è¾¹æ æ·»åŠ å¯¼èˆªé¡¹**

```html
<!-- åœ¨ä¾§è¾¹æ å¯¼èˆªä¸­æ·»åŠ  -->
<a href="/admin/reports" class="nav-item">
    <span class="nav-icon">ğŸ“Š</span>
    <span class="nav-text">ç»Ÿè®¡æŠ¥è¡¨</span>
</a>
```

### 3.2 æ·»åŠ æ–°çš„APIç«¯ç‚¹

**ä½¿ç”¨ç±»å‹æç¤ºå’Œé”™è¯¯å¤„ç†ï¼š**

```python
from typing import Dict, Any, Optional
from flask import request, jsonify
from ..utils.database import get_db

@admin_bp.route('/api/your-endpoint', methods=['POST'])
def api_your_endpoint() -> tuple[Dict[str, Any], int]:
    """
    æ–°APIç«¯ç‚¹
    
    Request Body:
        {
            "param1": "value1",
            "param2": 123
        }
    
    Returns:
        JSONå“åº”å’ŒHTTPçŠ¶æ€ç 
    """
    try:
        # 1. è·å–è¯·æ±‚æ•°æ®
        data = request.get_json()
        if not data:
            return jsonify({
                'status': 'error',
                'message': 'è¯·æ±‚æ•°æ®ä¸èƒ½ä¸ºç©º'
            }), 400
        
        # 2. æ•°æ®éªŒè¯ï¼ˆä½¿ç”¨Pydanticæˆ–è‡ªå®šä¹‰éªŒè¯å™¨ï¼‰
        param1 = data.get('param1')
        if not param1:
            return jsonify({
                'status': 'error',
                'message': 'param1æ˜¯å¿…å¡«é¡¹'
            }), 400
        
        # 3. ä¸šåŠ¡é€»è¾‘
        conn = get_db()
        # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
        conn.execute('INSERT INTO ...', (param1,))
        conn.commit()
        
        # 4. è¿”å›æˆåŠŸå“åº”
        return jsonify({
            'status': 'success',
            'message': 'æ“ä½œæˆåŠŸ',
            'data': {'id': conn.lastrowid}
        }), 201
        
    except sqlite3.IntegrityError as e:
        return jsonify({
            'status': 'error',
            'message': 'æ•°æ®å·²å­˜åœ¨æˆ–è¿åçº¦æŸ'
        }), 400
    except Exception as e:
        current_app.logger.error(f"APIé”™è¯¯: {e}", exc_info=True)
        return jsonify({
            'status': 'error',
            'message': 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
        }), 500
```

### 3.3 æ·»åŠ æ‰¹é‡æ“ä½œåŠŸèƒ½

**ç¤ºä¾‹ï¼šæ‰¹é‡æ“ä½œé¢˜ç›®**

```python
@admin_bp.route('/api/questions/batch_operation', methods=['POST'])
def api_batch_operation():
    """æ‰¹é‡æ“ä½œé¢˜ç›®"""
    try:
        data = request.get_json()
        ids = data.get('ids', [])
        operation = data.get('operation')  # 'delete', 'move', 'update'
        
        if not ids:
            return jsonify({
                'status': 'error',
                'message': 'è¯·é€‰æ‹©è¦æ“ä½œçš„é¢˜ç›®'
            }), 400
        
        conn = get_db()
        
        if operation == 'delete':
            placeholders = ','.join(['?'] * len(ids))
            conn.execute(f'DELETE FROM questions WHERE id IN ({placeholders})', ids)
            conn.commit()
            return jsonify({
                'status': 'success',
                'message': f'æˆåŠŸåˆ é™¤ {len(ids)} é“é¢˜ç›®'
            })
        
        # å…¶ä»–æ“ä½œ...
        
    except Exception as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 500
```

## 4. UI/UXè§„èŒƒ

### 4.1 è®¾è®¡é£æ ¼

**éµå¾ªiOS 18é£æ ¼è®¾è®¡ï¼š**

- **é¢œè‰²**: ä½¿ç”¨CSSå˜é‡ï¼ˆ`var(--primary)`, `var(--text-color)` ç­‰ï¼‰
- **åœ†è§’**: `var(--radius-sm)`, `var(--radius-md)`, `var(--radius-lg)`
- **æ¯›ç»ç’ƒæ•ˆæœ**: `backdrop-filter: blur(30px) saturate(180%)`
- **é˜´å½±**: `var(--shadow-soft)`, `var(--shadow)`
- **é—´è·**: ä½¿ç”¨ç»Ÿä¸€çš„é—´è·ç³»ç»Ÿï¼ˆ8px, 12px, 16px, 24px, 40pxï¼‰

### 4.2 æŒ‰é’®æ ·å¼

**ä½¿ç”¨ç»Ÿä¸€çš„æŒ‰é’®ç±»ï¼š**

```html
<!-- ä¸»è¦æ“ä½œ -->
<button class="btn-primary">æ–°å¢</button>

<!-- å±é™©æ“ä½œ -->
<button class="btn-danger">åˆ é™¤</button>

<!-- æ¬¡è¦æ“ä½œ -->
<button class="btn-outline">å–æ¶ˆ</button>
```

**æŒ‰é’®ç‰¹æ€§ï¼š**
- åŠé€æ˜èƒŒæ™¯ï¼š`rgba(0, 122, 255, 0.7)`
- æ¯›ç»ç’ƒæ•ˆæœï¼š`backdrop-filter: blur(20px)`
- ç»Ÿä¸€é«˜åº¦ï¼š`44px`
- ç»Ÿä¸€æœ€å°å®½åº¦ï¼š`100px`
- æ‚¬åœæ•ˆæœï¼šè½»å¾®ä¸Šç§» + é˜´å½±

### 4.3 è¡¨æ ¼æ ·å¼

**ä½¿ç”¨ç»Ÿä¸€çš„è¡¨æ ¼æ ·å¼ï¼š**

```html
<div class="table-wrapper">
    <table>
        <thead>
            <tr>
                <th>åˆ—å1</th>
                <th>åˆ—å2</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>æ•°æ®1</td>
                <td>æ•°æ®2</td>
            </tr>
        </tbody>
    </table>
</div>
```

### 4.4 æ¨¡æ€æ¡†/æŠ½å±‰

**ä½¿ç”¨ç»Ÿä¸€çš„æŠ½å±‰æ ·å¼ï¼š**

```html
<div class="drawer" id="myDrawer">
    <div class="drawer-header">
        <span>æ ‡é¢˜</span>
        <button class="drawer-close" onclick="closeDrawer()">Ã—</button>
    </div>
    <div class="drawer-body">
        <!-- å†…å®¹ -->
    </div>
    <div class="drawer-footer">
        <button class="btn-secondary" onclick="closeDrawer()">å–æ¶ˆ</button>
        <button class="btn-primary" onclick="save()">ä¿å­˜</button>
    </div>
</div>
```

## 5. æ•°æ®éªŒè¯ä¸é”™è¯¯å¤„ç†

### 5.1 ä½¿ç”¨Pydanticè¿›è¡ŒéªŒè¯ï¼ˆæ¨èï¼‰

```python
from pydantic import BaseModel, Field, validator
from typing import Optional

class SubjectCreateSchema(BaseModel):
    name: str = Field(..., min_length=1, max_length=100, description="ç§‘ç›®åç§°")
    description: Optional[str] = Field(None, max_length=500, description="ç§‘ç›®æè¿°")
    
    @validator('name')
    def validate_name(cls, v):
        if not v.strip():
            raise ValueError('ç§‘ç›®åç§°ä¸èƒ½ä¸ºç©º')
        return v.strip()

@admin_bp.route('/api/subjects', methods=['POST'])
def api_create_subject():
    try:
        # ä½¿ç”¨PydanticéªŒè¯
        data = SubjectCreateSchema.parse_obj(request.json)
        
        conn = get_db()
        conn.execute(
            'INSERT INTO subjects (name, description) VALUES (?, ?)',
            (data.name, data.description)
        )
        conn.commit()
        
        return jsonify({
            'status': 'success',
            'message': 'ç§‘ç›®åˆ›å»ºæˆåŠŸ'
        }), 201
    except ValueError as e:
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 400
```

### 5.2 ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å™¨

```python
from ..utils.validators import validate_password, parse_int

@admin_bp.route('/api/users', methods=['POST'])
def api_create_user():
    data = request.get_json()
    
    # ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å™¨
    password = data.get('password')
    if not validate_password(password):
        return jsonify({
            'status': 'error',
            'message': 'å¯†ç ä¸ç¬¦åˆè¦æ±‚'
        }), 400
```

### 5.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```python
@admin_bp.route('/api/endpoint', methods=['POST'])
def api_endpoint():
    try:
        # ä¸šåŠ¡é€»è¾‘
        pass
    except sqlite3.IntegrityError as e:
        # æ•°æ®åº“çº¦æŸé”™è¯¯
        return jsonify({
            'status': 'error',
            'message': 'æ•°æ®å·²å­˜åœ¨æˆ–è¿åçº¦æŸ'
        }), 400
    except ValueError as e:
        # æ•°æ®éªŒè¯é”™è¯¯
        return jsonify({
            'status': 'error',
            'message': str(e)
        }), 400
    except Exception as e:
        # å…¶ä»–é”™è¯¯ - è®°å½•æ—¥å¿—ä½†ä¸æš´éœ²ç»†èŠ‚
        current_app.logger.error(f"APIé”™è¯¯: {e}", exc_info=True)
        return jsonify({
            'status': 'error',
            'message': 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
        }), 500
```

## 6. æƒé™æ§åˆ¶

### 6.1 ä½¿ç”¨è£…é¥°å™¨

**ç®¡ç†å‘˜è£…é¥°å™¨**ï¼ˆä»…ç®¡ç†å‘˜å¯è®¿é—®ï¼‰ï¼š
```python
from ..utils.decorators import admin_required

@admin_bp.route('/api/sensitive', methods=['POST'])
@admin_required
def api_sensitive():
    """éœ€è¦ç®¡ç†å‘˜æƒé™çš„API"""
    # åªæœ‰ç®¡ç†å‘˜å¯ä»¥è®¿é—®
    pass
```

**ç§‘ç›®ç®¡ç†å‘˜è£…é¥°å™¨**ï¼ˆç®¡ç†å‘˜å’Œç§‘ç›®ç®¡ç†å‘˜éƒ½å¯è®¿é—®ï¼‰ï¼š
```python
from ..utils.decorators import subject_admin_required

@admin_bp.route('/api/subjects', methods=['POST'])
@subject_admin_required
def api_create_subject():
    """åˆ›å»ºç§‘ç›®ï¼ˆç®¡ç†å‘˜å’Œç§‘ç›®ç®¡ç†å‘˜éƒ½å¯è®¿é—®ï¼‰"""
    # ç®¡ç†å‘˜å’Œç§‘ç›®ç®¡ç†å‘˜éƒ½å¯ä»¥è®¿é—®
    pass
```

### 6.2 æ‰‹åŠ¨æ£€æŸ¥æƒé™

**æ£€æŸ¥ç®¡ç†å‘˜æƒé™**ï¼š
```python
@admin_bp.route('/api/endpoint', methods=['POST'])
def api_endpoint():
    if not session.get('is_admin'):
        return jsonify({
            'status': 'forbidden',
            'message': 'éœ€è¦ç®¡ç†å‘˜æƒé™'
        }), 403
    # ä¸šåŠ¡é€»è¾‘
```

**æ£€æŸ¥ç§‘ç›®ç®¡ç†å‘˜æƒé™**ï¼ˆå…è®¸ç®¡ç†å‘˜å’Œç§‘ç›®ç®¡ç†å‘˜ï¼‰ï¼š
```python
@admin_bp.route('/api/endpoint', methods=['POST'])
def api_endpoint():
    is_admin_user = session.get('is_admin')
    is_subject_admin_user = session.get('is_subject_admin')
    
    if not (is_admin_user or is_subject_admin_user):
        return jsonify({
            'status': 'forbidden',
            'message': 'éœ€è¦ç®¡ç†å‘˜æˆ–ç§‘ç›®ç®¡ç†å‘˜æƒé™'
        }), 403
    # ä¸šåŠ¡é€»è¾‘
```

## 7. æ•°æ®åº“æ“ä½œè§„èŒƒ

### 7.1 ä½¿ç”¨äº‹åŠ¡

```python
conn = get_db()
try:
    conn.execute('INSERT INTO ...', (param1,))
    conn.execute('UPDATE ... SET ...', (param2,))
    conn.commit()  # æäº¤äº‹åŠ¡
except Exception as e:
    conn.rollback()  # å›æ»š
    raise
```

### 7.2 é˜²æ­¢SQLæ³¨å…¥

**âœ… GOOD: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢**

```python
conn.execute('SELECT * FROM users WHERE id = ?', (user_id,))
conn.execute('INSERT INTO subjects (name) VALUES (?)', (name,))
```

**âŒ BAD: å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆå±é™©ï¼‰**

```python
# ä¸è¦è¿™æ ·åšï¼
conn.execute(f'SELECT * FROM users WHERE id = {user_id}')
```

### 7.3 æŸ¥è¯¢ç»“æœå¤„ç†

```python
# è·å–å•æ¡è®°å½•
row = conn.execute('SELECT * FROM subjects WHERE id = ?', (id,)).fetchone()
if row:
    data = dict(row)

# è·å–å¤šæ¡è®°å½•
rows = conn.execute('SELECT * FROM subjects').fetchall()
data = [dict(row) for row in rows]

# è·å–å•ä¸ªå€¼
count = conn.execute('SELECT COUNT(*) FROM questions').fetchone()[0]
```

### 7.4 æ•°æ®åº“å­—æ®µè‡ªåŠ¨è¿ç§»

**åœ¨ `app/utils/database.py` çš„ `_create_tables()` å‡½æ•°ä¸­æ·»åŠ å­—æ®µè¿ç§»é€»è¾‘ï¼š**

```python
# æ·»åŠ  subjects è¡¨çš„ is_locked å­—æ®µï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
try:
    cur = conn.cursor()
    subject_cols = [r['name'] for r in cur.execute("PRAGMA table_info(subjects)").fetchall()]
    if 'is_locked' not in subject_cols:
        cur.execute('ALTER TABLE subjects ADD COLUMN is_locked INTEGER DEFAULT 0')
except Exception:
    pass
```

**æ³¨æ„äº‹é¡¹ï¼š**
- ä½¿ç”¨ `PRAGMA table_info()` æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
- ä½¿ç”¨ `try-except` åŒ…è£¹ï¼Œé¿å…é‡å¤æ·»åŠ å­—æ®µæ—¶æŠ¥é”™
- æ–°å­—æ®µåº”è®¾ç½®åˆç†çš„é»˜è®¤å€¼ï¼ˆå¦‚ `DEFAULT 0`ï¼‰

## 8. å‰ç«¯JavaScriptè§„èŒƒ

### 8.1 å¼‚æ­¥æ“ä½œä½¿ç”¨async/await

```javascript
async function loadData() {
    try {
        const res = await fetch('/admin/api/endpoint');
        const result = await res.json();
        if (result.status === 'success') {
            // å¤„ç†æˆåŠŸ
            renderData(result.data);
        } else {
            // å¤„ç†é”™è¯¯
            showError(result.message);
        }
    } catch (error) {
        console.error('è¯·æ±‚å¤±è´¥:', error);
        showError('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
    }
}
```

### 8.2 ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

```javascript
function showError(message) {
    alert('âŒ ' + message);
}

function showSuccess(message) {
    alert('âœ… ' + message);
}
```

### 8.3 ä¸‹æ‹‰èœå•å®ç°

**åŸºç¡€ä¸‹æ‹‰èœå•ï¼ˆé€šç”¨æ¨¡å¼ï¼‰ï¼š**

```javascript
function toggleDropdown(id) {
    const menu = document.getElementById(id);
    const isOpen = menu.classList.contains('open') || menu.style.display === 'block';
    
    // å…ˆå…³é—­å…¶ä»–èœå•
    document.querySelectorAll('.dropdown-menu').forEach(m => {
        m.classList.remove('open');
        m.style.display = 'none';
    });
    
    if (!isOpen) {
        menu.classList.add('open');
        menu.style.display = 'block';
    }
}

// ç‚¹å‡»å¤–éƒ¨å…³é—­
document.addEventListener('click', (e) => {
    if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown-menu').forEach(m => {
            m.classList.remove('open');
            m.style.display = 'none';
        });
    }
});
```

**è¡¨æ ¼æ“ä½œä¸‹æ‹‰èœå•ï¼ˆå³ä¾§å¼¹å‡ºæ¨¡å¼ï¼‰ï¼š**

å½“è¡¨æ ¼ä¸­æœ‰å¤šä¸ªæ“ä½œæŒ‰é’®æ—¶ï¼Œå»ºè®®ä½¿ç”¨ä¸‹æ‹‰èœå•åˆå¹¶æ“ä½œï¼Œèœå•åœ¨æŒ‰é’®å³ä¾§å¼¹å‡ºï¼Œé¿å…è¢«ä¸‹æ–¹è¡Œé®æŒ¡ï¼š

```html
<div class="dropdown action-dropdown">
    <button class="btn-sm btn-action" onclick="toggleActionMenu(${id}, event)">
        <span>æ“ä½œ</span>
        <span style="margin-left: 4px; font-size: 12px;">â–¼</span>
    </button>
    <div id="action-menu-${id}" class="action-menu dropdown-menu">
        <button class="action-item" onclick="action1(${id}); closeActionMenu(${id});">
            <span class="action-icon">ğŸ“š</span>
            <span class="action-text">æ“ä½œ1</span>
        </button>
        <button class="action-item action-danger" onclick="action2(${id}); closeActionMenu(${id});">
            <span class="action-icon">ğŸ—‘ï¸</span>
            <span class="action-text">åˆ é™¤</span>
        </button>
    </div>
</div>
```

```css
.action-dropdown {
    position: relative;
    display: inline-block;
}
.action-menu {
    display: none;
    position: absolute;
    left: 100%; /* å®šä½åˆ°æŒ‰é’®å³ä¾§ */
    top: 0; /* ä¸æŒ‰é’®é¡¶éƒ¨å¯¹é½ */
    margin-left: 8px;
    min-width: 160px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px) saturate(180%);
    border: 0.5px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    padding: 4px 0;
    z-index: 1000;
    animation: slideRight 0.2s ease;
}
.action-menu.open {
    display: block;
}
.action-item {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 10px 16px;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
    font-size: 14px;
    color: var(--text-color);
}
.action-item:hover {
    background: rgba(142, 142, 147, 0.1);
}
.action-item.action-danger {
    color: var(--danger);
}
@keyframes slideRight {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}
```

```javascript
function toggleActionMenu(id, event) {
    event.stopPropagation();
    const menuId = `action-menu-${id}`;
    const menu = document.getElementById(menuId);
    const isOpen = menu.classList.contains('open') || menu.style.display === 'block';
    
    // å…ˆå…³é—­æ‰€æœ‰å…¶ä»–èœå•
    document.querySelectorAll('.action-menu').forEach(m => {
        m.classList.remove('open');
        m.style.display = 'none';
    });
    
    if (!isOpen) {
        menu.classList.add('open');
        menu.style.display = 'block';
    }
}

function closeActionMenu(id) {
    const menuId = `action-menu-${id}`;
    const menu = document.getElementById(menuId);
    if (menu) {
        menu.classList.remove('open');
        menu.style.display = 'none';
    }
}

// ç‚¹å‡»å¤–éƒ¨å…³é—­æ‰€æœ‰ä¸‹æ‹‰èœå•
document.addEventListener('click', (e) => {
    if (!e.target.closest('.action-dropdown')) {
        document.querySelectorAll('.action-menu').forEach(m => {
            m.classList.remove('open');
            m.style.display = 'none';
        });
    }
});
```

**æ³¨æ„äº‹é¡¹ï¼š**
- è¡¨æ ¼å®¹å™¨åº”è®¾ç½® `overflow: visible`ï¼Œé¿å…èœå•è¢«è£å‰ª
- èœå• `z-index` åº”è¶³å¤Ÿé«˜ï¼ˆå»ºè®® 1000+ï¼‰ï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚
- è¡¨æ ¼è¡Œåº”è®¾ç½® `position: relative`ï¼Œç¡®ä¿èœå•å®šä½æ­£ç¡®

## 9. å¸¸è§åŠŸèƒ½æ¨¡å¼

### 9.1 åˆ—è¡¨é¡µé¢æ¨¡å¼

```python
# åç«¯ï¼šåˆ†é¡µæŸ¥è¯¢
@admin_bp.route('/api/items', methods=['GET'])
def api_get_items():
    page = request.args.get('page', 1, type=int)
    per_page = request.args.get('per_page', 20, type=int)
    offset = (page - 1) * per_page
    
    conn = get_db()
    items = conn.execute(
        'SELECT * FROM items LIMIT ? OFFSET ?',
        (per_page, offset)
    ).fetchall()
    total = conn.execute('SELECT COUNT(*) FROM items').fetchone()[0]
    
    return jsonify({
        'status': 'success',
        'data': {
            'items': [dict(row) for row in items],
            'total': total,
            'page': page,
            'per_page': per_page
        }
    })
```

```javascript
// å‰ç«¯ï¼šåŠ è½½åˆ—è¡¨
let currentPage = 1;
async function loadItems() {
    const res = await fetch(`/admin/api/items?page=${currentPage}`);
    const result = await res.json();
    if (result.status === 'success') {
        renderItems(result.data.items);
        updatePagination(result.data);
    }
}
```

### 9.2 æœç´¢åŠŸèƒ½

```python
@admin_bp.route('/api/items/search', methods=['GET'])
def api_search_items():
    keyword = request.args.get('keyword', '').strip()
    
    conn = get_db()
    if keyword:
        items = conn.execute(
            'SELECT * FROM items WHERE name LIKE ?',
            (f'%{keyword}%',)
        ).fetchall()
    else:
        items = conn.execute('SELECT * FROM items').fetchall()
    
    return jsonify({
        'status': 'success',
        'data': [dict(row) for row in items]
    })
```

### 9.3 æ–‡ä»¶ä¸Šä¼ 

```python
from werkzeug.utils import secure_filename
import os

@admin_bp.route('/api/upload', methods=['POST'])
def api_upload():
    if 'file' not in request.files:
        return jsonify({'status': 'error', 'message': 'æ²¡æœ‰æ–‡ä»¶'}), 400
    
    file = request.files['file']
    if file.filename == '':
        return jsonify({'status': 'error', 'message': 'æ–‡ä»¶åä¸ºç©º'}), 400
    
    # å®‰å…¨æ–‡ä»¶å
    filename = secure_filename(file.filename)
    upload_path = os.path.join(current_app.config['UPLOAD_FOLDER'], filename)
    file.save(upload_path)
    
    return jsonify({
        'status': 'success',
        'message': 'ä¸Šä¼ æˆåŠŸ',
        'path': filename
    })
```

## 10. æµ‹è¯•ä¸è°ƒè¯•

### 10.1 æ—¥å¿—è®°å½•

```python
from flask import current_app

# è®°å½•ä¿¡æ¯
current_app.logger.info('æ“ä½œæˆåŠŸ')

# è®°å½•é”™è¯¯
current_app.logger.error(f'æ“ä½œå¤±è´¥: {e}', exc_info=True)
```

### 10.2 è°ƒè¯•æŠ€å·§

- ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥ç½‘ç»œè¯·æ±‚
- æ£€æŸ¥Flaskæ—¥å¿—è¾“å‡º
- ä½¿ç”¨ `print()` æˆ– `current_app.logger.debug()` è°ƒè¯•
- æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ï¼š`sqlite3 instance/quiz.db`

## 11. ä»£ç å®¡æŸ¥æ¸…å•

æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œç¡®ä¿ï¼š

- [ ] éµå¾ªé¡¹ç›®ä»£ç ç»„ç»‡è§„èŒƒ
- [ ] ä½¿ç”¨ç±»å‹æç¤º
- [ ] æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†
- [ ] ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
- [ ] APIè¿”å›ç»Ÿä¸€çš„JSONæ ¼å¼
- [ ] UIéµå¾ªiOS 18è®¾è®¡é£æ ¼
- [ ] æ·»åŠ å¿…è¦çš„æƒé™æ£€æŸ¥
- [ ] ä»£ç æœ‰é€‚å½“çš„æ³¨é‡Š
- [ ] éµå¾ªRESTful APIè®¾è®¡åŸåˆ™
- [ ] å‰ç«¯ä½¿ç”¨async/awaitå¤„ç†å¼‚æ­¥æ“ä½œ

## 12. å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ç®¡ç†é¡µé¢ï¼Ÿ

A: å‚è€ƒç¬¬3.1èŠ‚ï¼Œéœ€è¦ï¼š
1. åœ¨ `admin.py` æ·»åŠ è·¯ç”±
2. åˆ›å»ºå¯¹åº”çš„HTMLæ¨¡æ¿
3. åœ¨ `admin_base.html` ä¾§è¾¹æ æ·»åŠ å¯¼èˆª

### Q: å¦‚ä½•ä¿®æ”¹ç°æœ‰åŠŸèƒ½ï¼Ÿ

A: 
1. æ‰¾åˆ°å¯¹åº”çš„è·¯ç”±å‡½æ•°
2. ç†è§£ç°æœ‰é€»è¾‘
3. è¿›è¡Œä¿®æ”¹ï¼Œä¿æŒå‘åå…¼å®¹
4. æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### Q: å¦‚ä½•è°ƒè¯•APIï¼Ÿ

A: 
1. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾
2. æŸ¥çœ‹Flaskæ—¥å¿—è¾“å‡º
3. æ£€æŸ¥æ•°æ®åº“æ•°æ®
4. ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•API

### Q: æ ·å¼ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠï¼Ÿ

A: 
1. æ£€æŸ¥CSSé€‰æ‹©å™¨æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ˜¯å¦æœ‰æ ·å¼å†²çªï¼ˆä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼‰
3. ç¡®ä¿CSSå˜é‡å·²å®šä¹‰
4. æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜é—®é¢˜ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰

### Q: å¦‚ä½•å®ç°ç§‘ç›®é”å®šåŠŸèƒ½ï¼Ÿ

A: ç§‘ç›®é”å®šåŠŸèƒ½ç”¨äºæ§åˆ¶å‰å°ç”¨æˆ·å¯¹ç§‘ç›®çš„è®¿é—®æƒé™ã€‚å®ç°æ­¥éª¤ï¼š

1. **æ•°æ®åº“å­—æ®µ**ï¼šåœ¨ `subjects` è¡¨ä¸­æ·»åŠ  `is_locked` å­—æ®µï¼ˆINTEGERï¼Œ0=æœªé”å®šï¼Œ1=é”å®šï¼‰
2. **ç®¡ç†åå°API**ï¼š
   - `GET /admin/api/subjects`ï¼šè¿”å›ç§‘ç›®åˆ—è¡¨æ—¶åŒ…å« `is_locked` å­—æ®µ
   - `POST /admin/api/subjects/<id>/lock`ï¼šé”å®šç§‘ç›®
   - `POST /admin/api/subjects/<id>/unlock`ï¼šè§£é”ç§‘ç›®
3. **å‰å°è¿‡æ»¤**ï¼šæ‰€æœ‰è·å–ç§‘ç›®åˆ—è¡¨çš„æŸ¥è¯¢éƒ½åº”æ·»åŠ  `WHERE (is_locked=0 OR is_locked IS NULL)` æ¡ä»¶
4. **ç®¡ç†åå°UI**ï¼šåœ¨ç§‘ç›®åˆ—è¡¨ä¸­æ·»åŠ é”å®š/è§£é”æŒ‰é’®ï¼Œæ˜¾ç¤ºé”å®šçŠ¶æ€

**å…³é”®ç‚¹ï¼š**
- é”å®šçš„ç§‘ç›®åœ¨å‰å°å®Œå…¨ä¸æ˜¾ç¤ºï¼ˆé¦–é¡µã€è®¾ç½®é¡µã€æœç´¢ç­‰ï¼‰
- é”å®šçš„ç§‘ç›®ä¸‹çš„é¢˜ç›®ä¹Ÿä¸åº”åœ¨å‰å°æ˜¾ç¤º
- ç®¡ç†åå°å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç§‘ç›®ï¼ˆåŒ…æ‹¬é”å®šçš„ï¼‰ï¼Œå¹¶å¯ä»¥è§£é”

### Q: ä¸‹æ‹‰èœå•è¢«è¡¨æ ¼è¡Œé®æŒ¡æ€ä¹ˆåŠï¼Ÿ

A: 
1. å°†èœå•å®šä½æ”¹ä¸ºæŒ‰é’®å³ä¾§ï¼š`left: 100%; top: 0;`
2. è¡¨æ ¼å®¹å™¨è®¾ç½® `overflow: visible`
3. æé«˜èœå• `z-index`ï¼ˆå»ºè®® 1000+ï¼‰
4. è¡¨æ ¼è¡Œè®¾ç½® `position: relative`

### Q: å¦‚ä½•è®¾ç½®ç§‘ç›®ç®¡ç†å‘˜ï¼Ÿ

A: 
1. ç®¡ç†å‘˜ç™»å½•åå°ï¼Œè¿›å…¥"ç”¨æˆ·ç®¡ç†"é¡µé¢
2. åœ¨ç”¨æˆ·æ“ä½œèœå•ä¸­é€‰æ‹©"è®¾ä¸ºç§‘ç›®ç®¡ç†å‘˜"
3. è¯¥ç”¨æˆ·å³å¯ç™»å½•åå°ï¼Œä½†åªèƒ½è®¿é—®ç§‘ç›®å’Œé¢˜é›†ç®¡ç†åŠŸèƒ½
4. ç§‘ç›®ç®¡ç†å‘˜åœ¨é¦–é¡µå’Œç”¨æˆ·ä¸­å¿ƒå¯ä»¥çœ‹åˆ°ç®¡ç†åå°å…¥å£

### Q: ç§‘ç›®ç®¡ç†å‘˜å¯ä»¥è®¿é—®å“ªäº›åŠŸèƒ½ï¼Ÿ

A: ç§‘ç›®ç®¡ç†å‘˜å¯ä»¥è®¿é—®ï¼š
- ç§‘ç›®ç®¡ç†ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€é”å®š/è§£é”ï¼‰
- é¢˜é›†ç®¡ç†ï¼ˆé¢˜ç›®çš„å¢åˆ æ”¹æŸ¥ã€æ‰¹é‡æ“ä½œï¼‰
- Excelæ¨¡æ¿ä¸‹è½½
- é¢˜ç›®å¯¼å…¥/å¯¼å‡ºï¼ˆExcelã€JSONã€ZIPåŒ…ï¼‰
- é¢˜ç›®å›¾ç‰‡ä¸Šä¼ 

ç§‘ç›®ç®¡ç†å‘˜**ä¸èƒ½**è®¿é—®ï¼š
- ä»ªè¡¨ç›˜
- ç”¨æˆ·ç®¡ç†
- èŠå¤©ç®¡ç†
- é€šçŸ¥ç®¡ç†

### Q: å¦‚ä½•ä¸ºæ–°è·¯ç”±æ·»åŠ ç§‘ç›®ç®¡ç†å‘˜æƒé™ï¼Ÿ

A: åœ¨ `app/__init__.py` çš„ `before_request` ä¸­ï¼Œå°†æ–°è·¯ç”±æ·»åŠ åˆ° `is_subject_admin_path` çš„åˆ¤æ–­æ¡ä»¶ä¸­ï¼š

```python
is_subject_admin_path = (
    path.startswith('/admin/subjects') or
    path.startswith('/admin/api/subjects') or
    path.startswith('/admin/questions') or
    path == '/admin/download_template' or
    path == '/admin/your_new_route' or  # æ·»åŠ æ–°è·¯ç”±
    '/api/subjects' in path or
    '/api/questions' in path
)
```

æˆ–è€…ä½¿ç”¨ `@subject_admin_required` è£…é¥°å™¨ï¼ˆå¦‚æœè·¯ç”±åœ¨ `admin.py` ä¸­ï¼‰ã€‚

## 13. å‚è€ƒèµ„æº

- Flaskæ–‡æ¡£: https://flask.palletsprojects.com/
- SQLiteæ–‡æ¡£: https://www.sqlite.org/docs.html
- Pydanticæ–‡æ¡£: https://docs.pydantic.dev/
- iOSè®¾è®¡æŒ‡å—: https://developer.apple.com/design/human-interface-guidelines/

---

## 14. åŠŸèƒ½ç‰¹æ€§è¯´æ˜

### 14.1 ç§‘ç›®é”å®šåŠŸèƒ½

**åŠŸèƒ½æè¿°ï¼š**
ç§‘ç›®é”å®šåŠŸèƒ½å…è®¸ç®¡ç†å‘˜æ§åˆ¶å‰å°ç”¨æˆ·å¯¹ç‰¹å®šç§‘ç›®çš„è®¿é—®ã€‚é”å®šçš„ç§‘ç›®åœ¨å‰å°å®Œå…¨ä¸æ˜¾ç¤ºï¼Œç”¨æˆ·æ— æ³•æŸ¥çœ‹å’Œä½¿ç”¨è¯¥ç§‘ç›®ä¸‹çš„é¢˜ç›®ã€‚

**æ•°æ®åº“è®¾è®¡ï¼š**
- è¡¨ï¼š`subjects`
- å­—æ®µï¼š`is_locked` (INTEGER, DEFAULT 0)
  - `0` æˆ– `NULL`ï¼šæœªé”å®šï¼ˆæ­£å¸¸æ˜¾ç¤ºï¼‰
  - `1`ï¼šå·²é”å®šï¼ˆå‰å°éšè—ï¼‰

**APIç«¯ç‚¹ï¼š**
- `GET /admin/api/subjects`ï¼šè¿”å›ç§‘ç›®åˆ—è¡¨ï¼ŒåŒ…å« `is_locked` å­—æ®µ
- `POST /admin/api/subjects/<id>/lock`ï¼šé”å®šæŒ‡å®šç§‘ç›®
- `POST /admin/api/subjects/<id>/unlock`ï¼šè§£é”æŒ‡å®šç§‘ç›®

**å‰å°è¿‡æ»¤è§„åˆ™ï¼š**
æ‰€æœ‰è·å–ç§‘ç›®åˆ—è¡¨çš„æŸ¥è¯¢å¿…é¡»æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼š
```sql
WHERE (is_locked=0 OR is_locked IS NULL)
```

**éœ€è¦è¿‡æ»¤çš„æ¥å£ï¼š**
- `GET /api/subjects`ï¼šå‰å°ç§‘ç›®åˆ—è¡¨
- `GET /`ï¼šé¦–é¡µç§‘ç›®é€‰æ‹©
- `GET /search`ï¼šæœç´¢é¡µç§‘ç›®ç­›é€‰
- `GET /quiz`ï¼šåˆ·é¢˜é¡µç§‘ç›®ç­›é€‰
- `GET /api/questions/count`ï¼šé¢˜ç›®è®¡æ•°æŸ¥è¯¢

**ç®¡ç†åå°UIï¼š**
- ç§‘ç›®åˆ—è¡¨æ˜¾ç¤ºé”å®šçŠ¶æ€ï¼ˆğŸ”’ å·²é”å®š / âœ“ æ­£å¸¸ï¼‰
- æä¾›é”å®š/è§£é”æ“ä½œæŒ‰é’®
- ä½¿ç”¨ä¸‹æ‹‰èœå•æ•´åˆæ‰€æœ‰æ“ä½œï¼ˆé¢˜é›†ç®¡ç†ã€ç¼–è¾‘ã€é”å®š/è§£é”ã€åˆ é™¤ï¼‰

### 14.2 è¡¨æ ¼æ“ä½œä¸‹æ‹‰èœå•

**è®¾è®¡åŸåˆ™ï¼š**
å½“è¡¨æ ¼è¡Œæœ‰å¤šä¸ªæ“ä½œæŒ‰é’®æ—¶ï¼Œä½¿ç”¨ä¸‹æ‹‰èœå•åˆå¹¶æ“ä½œï¼Œæå‡ç•Œé¢æ•´æ´åº¦ã€‚

**å®ç°è¦ç‚¹ï¼š**
1. **å®šä½æ–¹å¼**ï¼šèœå•åœ¨æŒ‰é’®å³ä¾§å¼¹å‡ºï¼ˆ`left: 100%`ï¼‰ï¼Œé¿å…è¢«ä¸‹æ–¹è¡Œé®æŒ¡
2. **å±‚çº§æ§åˆ¶**ï¼š`z-index: 1000`ï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚
3. **å®¹å™¨è®¾ç½®**ï¼šè¡¨æ ¼å®¹å™¨ `overflow: visible`ï¼Œè¡¨æ ¼è¡Œ `position: relative`
4. **äº¤äº’ä½“éªŒ**ï¼š
   - ç‚¹å‡»æŒ‰é’®æ‰“å¼€/å…³é—­èœå•
   - ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨å…³é—­
   - æŒ‰ `Escape` é”®å…³é—­
   - é€‰æ‹©æ“ä½œåè‡ªåŠ¨å…³é—­

**æ ·å¼è§„èŒƒï¼š**
- æ¯›ç»ç’ƒæ•ˆæœï¼š`backdrop-filter: blur(20px) saturate(180%)`
- åœ†è§’ï¼š`var(--radius-md)`
- é˜´å½±ï¼š`box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12)`
- åŠ¨ç”»ï¼š`slideRight` ä»å·¦ä¾§æ»‘å…¥

**æ“ä½œé¡¹åˆ†ç±»ï¼š**
- æ™®é€šæ“ä½œï¼šé»˜è®¤æ ·å¼
- è­¦å‘Šæ“ä½œï¼š`.action-warning`ï¼ˆæ©™è‰²ï¼Œå¦‚é”å®šï¼‰
- æˆåŠŸæ“ä½œï¼š`.action-success`ï¼ˆç»¿è‰²ï¼Œå¦‚è§£é”ï¼‰
- å±é™©æ“ä½œï¼š`.action-danger`ï¼ˆçº¢è‰²ï¼Œå¦‚åˆ é™¤ï¼‰ï¼Œç”¨åˆ†éš”çº¿åŒºåˆ†

---

## 15. ç§‘ç›®ç®¡ç†å‘˜åŠŸèƒ½

### 15.1 åŠŸèƒ½æ¦‚è¿°

ç§‘ç›®ç®¡ç†å‘˜æ˜¯ä»‹äºæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ä¹‹é—´çš„è§’è‰²ï¼Œä¸“é—¨è´Ÿè´£ç§‘ç›®å’Œé¢˜é›†çš„ç®¡ç†å·¥ä½œã€‚

**æƒé™èŒƒå›´**ï¼š
- âœ… å¯ä»¥è®¿é—®ç§‘ç›®ç®¡ç†é¡µé¢
- âœ… å¯ä»¥è®¿é—®é¢˜é›†ç®¡ç†é¡µé¢ï¼ˆç§‘ç›®ä¸‹çš„é¢˜ç›®ç®¡ç†ï¼‰
- âœ… å¯ä»¥ä¸‹è½½Excelæ¨¡æ¿
- âœ… å¯ä»¥å¯¼å…¥/å¯¼å‡ºé¢˜ç›®
- âœ… å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç§‘ç›®
- âœ… å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®
- âœ… å¯ä»¥æ‰¹é‡æ“ä½œé¢˜ç›®
- âŒ æ— æ³•è®¿é—®ç”¨æˆ·ç®¡ç†
- âŒ æ— æ³•è®¿é—®èŠå¤©ç®¡ç†
- âŒ æ— æ³•è®¿é—®é€šçŸ¥ç®¡ç†
- âŒ æ— æ³•è®¿é—®ä»ªè¡¨ç›˜ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰

### 15.2 æ•°æ®åº“è®¾è®¡

- è¡¨ï¼š`users`
- å­—æ®µï¼š`is_subject_admin` (INTEGER, DEFAULT 0)
  - `0` æˆ– `NULL`ï¼šéç§‘ç›®ç®¡ç†å‘˜
  - `1`ï¼šç§‘ç›®ç®¡ç†å‘˜

**æ³¨æ„**ï¼šç®¡ç†å‘˜ï¼ˆ`is_admin=1`ï¼‰è‡ªåŠ¨æ‹¥æœ‰æ‰€æœ‰ç§‘ç›®ç®¡ç†å‘˜çš„æƒé™ã€‚

### 15.3 æƒé™æ§åˆ¶å®ç°

**è·¯ç”±æƒé™æ£€æŸ¥**ï¼ˆ`app/__init__.py`ï¼‰ï¼š
- ç§‘ç›®ç®¡ç†å‘˜å…è®¸è®¿é—®çš„è·¯ç”±åŒ…æ‹¬ï¼š
  - `/admin/subjects` åŠå…¶å­è·¯å¾„
  - `/admin/api/subjects` åŠå…¶å­è·¯å¾„
  - `/admin/questions` åŠå…¶å­è·¯å¾„
  - `/admin/download_template`ï¼ˆExcelæ¨¡æ¿ä¸‹è½½ï¼‰
  - `/admin/api/questions` ç›¸å…³è·¯å¾„

**ä¾§è¾¹æ å¯¼èˆª**ï¼ˆ`app/templates/admin_base.html`ï¼‰ï¼š
- ç§‘ç›®ç®¡ç†å‘˜åªèƒ½çœ‹åˆ°"ç§‘ç›®ç®¡ç†"èœå•é¡¹
- ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°æ‰€æœ‰èœå•é¡¹

### 15.4 è®¾ç½®ç§‘ç›®ç®¡ç†å‘˜

**åœ¨ç”¨æˆ·ç®¡ç†é¡µé¢**ï¼š
1. è¿›å…¥ `/admin/users`
2. åœ¨ç”¨æˆ·æ“ä½œèœå•ä¸­é€‰æ‹©"è®¾ä¸ºç§‘ç›®ç®¡ç†å‘˜"æˆ–"å–æ¶ˆç§‘ç›®ç®¡ç†å‘˜"
3. ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ·æ–°ç›®æ ‡ç”¨æˆ·çš„ä¼šè¯

**APIç«¯ç‚¹**ï¼š
- `POST /admin/users/<id>/toggle_subject_admin`ï¼šåˆ‡æ¢ç§‘ç›®ç®¡ç†å‘˜æƒé™

### 15.5 å‰å°å…¥å£

**é¦–é¡µå…¥å£**ï¼š
- ç§‘ç›®ç®¡ç†å‘˜åœ¨é¦–é¡µå³ä¸Šè§’å¯ä»¥çœ‹åˆ°"ç®¡ç†"æŒ‰é’®
- ç‚¹å‡»åè·³è½¬åˆ° `/admin/subjects`

**ç”¨æˆ·ä¸­å¿ƒå…¥å£**ï¼š
- åœ¨ `/user_hub` é¡µé¢å¯ä»¥çœ‹åˆ°"ç®¡ç†ç«¯"å¡ç‰‡
- æè¿°æ˜¾ç¤ºä¸º"ç®¡ç†ç§‘ç›®å’Œé¢˜é›†"
- ç‚¹å‡»åè·³è½¬åˆ° `/admin/subjects`

### 15.6 ä»£ç å®ç°è¦ç‚¹

**è£…é¥°å™¨**ï¼ˆ`app/utils/decorators.py`ï¼‰ï¼š
- `subject_admin_required`ï¼šå…è®¸ç®¡ç†å‘˜å’Œç§‘ç›®ç®¡ç†å‘˜è®¿é—®
- `is_subject_admin()`ï¼šæ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯ç§‘ç›®ç®¡ç†å‘˜

**ä¼šè¯ç®¡ç†**ï¼š
- ç™»å½•æ—¶è®¾ç½® `session['is_subject_admin']`
- åœ¨ `before_request` ä¸­åŒæ­¥æ›´æ–°æƒé™ä¿¡æ¯

**æ•°æ®åº“å…¼å®¹æ€§**ï¼š
- æ‰€æœ‰æ¶‰åŠ `is_subject_admin` çš„æŸ¥è¯¢éƒ½ä¼šå…ˆæ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
- å¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨å°è¯•æ·»åŠ ï¼ˆå…¼å®¹æ—§æ•°æ®åº“ï¼‰
- ä½¿ç”¨ `'is_subject_admin' in row.keys()` æ£€æŸ¥å­—æ®µï¼Œè€Œä¸æ˜¯ `row.get()`

---

**æœ€åæ›´æ–°**: 2025-01-29
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
