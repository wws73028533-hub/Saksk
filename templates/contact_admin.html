<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>è”ç³»ç®¡ç†å‘˜ - å…¨èƒ½åˆ·é¢˜åº“</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','Helvetica Neue',Arial,sans-serif;background:#f5f5f7;margin:0;color:#1d1d1f}
    .wrap{max-width:860px;margin:0 auto;padding:28px 16px}
    .top a{text-decoration:none;color:#007aff}
    .card{background:#fff;border-radius:18px;padding:18px 16px;box-shadow:0 8px 24px rgba(0,0,0,.08);border:1px solid rgba(0,0,0,.06)}
    .title{font-size:22px;font-weight:650;margin:0 0 8px}
    .sub{color:#6e6e73;font-size:14px;line-height:1.6;margin:0 0 16px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:12px;border:none;background:#007aff;color:#fff;font-size:15px;font-weight:600;cursor:pointer}
    .btn[disabled]{opacity:.55;cursor:not-allowed}
    .hint{margin-top:12px;color:#6e6e73;font-size:13px;line-height:1.6}
    .list{margin-top:14px;padding-left:18px;color:#1d1d1f}
    .list li{margin:8px 0;color:#1d1d1f}
    code{background:#f2f2f7;padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top"><a href="/user_hub">â† è¿”å›åŠŸèƒ½ä¸­å¿ƒ</a></div>

    <div class="card" style="margin-top:14px;">
      <h1 class="title">è”ç³»ç®¡ç†å‘˜</h1>
      <p class="sub">é‡åˆ°ä½¿ç”¨é—®é¢˜ã€é¢˜ç›®çº é”™ã€åŠŸèƒ½å»ºè®®ç­‰ï¼Œéƒ½å¯ä»¥åœ¨è¿™é‡Œå‘èµ·ä¸ç®¡ç†å‘˜çš„ä¼šè¯ã€‚</p>

      {% if disabled %}
        <button class="btn" disabled>ğŸ’¬ å‘èµ·èŠå¤©ï¼ˆä¸å¯ç”¨ï¼‰</button>
        <div class="hint">åŸå› ï¼š{{ reason }}</div>
      {% else %}
        <button class="btn" onclick="startChatWithAdmin()">ğŸ’¬ ç›´æ¥èŠå¤©ï¼ˆè·³è½¬åˆ°ä¼šè¯ï¼‰</button>
        <div class="hint">å°†è‡ªåŠ¨åˆ›å»º/å¤ç”¨ä¸ç®¡ç†å‘˜ <b>{{ admin_username }}</b> çš„ç§èŠä¼šè¯ï¼Œå¹¶è·³è½¬åˆ°èŠå¤©é¡µã€‚</div>
      {% endif %}

      
    </div>
  </div>

  <script>
    async function startChatWithAdmin(){
      try{
        const peerUserId = {{ admin_user_id|default(0) }};
        if(!peerUserId){
          alert('æœªæ‰¾åˆ°ç®¡ç†å‘˜è´¦å·ï¼Œè¯·ç¨åå†è¯•');
          return;
        }

        const res = await fetch('/api/chat/conversations/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ peer_user_id: peerUserId })
        });
        const data = await res.json();
        if(!res.ok || data.status !== 'success'){
          alert(data.message || 'åˆ›å»ºä¼šè¯å¤±è´¥');
          return;
        }

        // è·³è½¬åˆ°èŠå¤©é¡µï¼Œå¹¶é€šè¿‡ query æŒ‡å®šæ‰“å¼€è¯¥ä¼šè¯ï¼ˆéœ€ chat.html æ”¯æŒï¼‰
        const cid = data.conversation_id;
        window.location.href = '/chat?conversation_id=' + encodeURIComponent(cid);
      }catch(e){
        console.error(e);
        alert('ç½‘ç»œå¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•');
      }
    }
  </script>
</body>
</html>


