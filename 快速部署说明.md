# Ubuntu 24.04.2 快速部署（最小可用）

本文档给出“能跑起来”的最小步骤；更完整的生产实践（目录分离、备份、HTTPS、Redis 限流等）请看 `生产环境部署指南.md`。

---

## 1) 安装依赖

```bash
sudo apt update
sudo apt -y install python3 python3-venv python3-pip nginx
```

---

## 2) 部署代码与依赖

```bash
sudo mkdir -p /opt/saksk-ti/app
sudo chown -R $USER:$USER /opt/saksk-ti
cd /opt/saksk-ti/app

# 放入项目代码（git clone 或上传）
# git clone <你的仓库地址> .

python3 -m venv .venv
./.venv/bin/pip install -U pip
./.venv/bin/pip install -r requirements.txt
```

---

## 3) 配置生产环境变量

```bash
cat > /opt/saksk-ti/app/.env <<'EOF'
FLASK_ENV=production
ENVIRONMENT=production
SECRET_KEY=CHANGE_ME
MAIL_ENABLED=false

# 邮件：支持后台配置（/admin/settings/mail），建议先关闭，配置好再开启

# 阿里云百炼（通义千问）AI 解析（可选）
# 未配置 DASHSCOPE_API_KEY 时会返回“占位解析”；配置后自动调用模型
# DASHSCOPE_API_KEY=PASTE_YOUR_KEY_HERE
# 北京地域（默认）：https://dashscope.aliyuncs.com/compatible-mode/v1
# 新加坡地域：    https://dashscope-intl.aliyuncs.com/compatible-mode/v1
# DASHSCOPE_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
# DASHSCOPE_MODEL=qwen-plus
EOF
```

---

## 4) 启动（临时方式）

```bash
cd /opt/saksk-ti/app
./.venv/bin/gunicorn --bind 127.0.0.1:8000 --workers 3 run:app
```

确认服务可用：

```bash
curl -I http://127.0.0.1:8000/
```

---

## 5) Nginx 反向代理（HTTP）


```bash
sudo tee /etc/nginx/sites-available/saksk-ti >/dev/null <<'EOF'
server {
  listen 80;
  server_name ti.example.com;
  location / { proxy_pass http://127.0.0.1:8000; }
}
EOF

sudo ln -sf /etc/nginx/sites-available/saksk-ti /etc/nginx/sites-enabled/saksk-ti
sudo nginx -t
sudo systemctl reload nginx
```

下一步：把 Gunicorn 改为 `systemd` 管理，并用 `certbot` 配置 HTTPS（见 `生产环境部署指南.md`）。
